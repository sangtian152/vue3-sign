"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("vue"),ae="@sangtian152/vue3-sign",se="sangtian152",re="0.0.1",ie="lib/vue3-sign.umd.js",le="lib/vue3-sign.mjs",ce={".":{import:"./lib/vue3-sign.mjs",require:"./lib/vue3-sign.umd.cjs"}},ue="lib/index.d.ts",de="MIT",pe="https://sangtian152.github.io/vue3-sign",fe=["lib"],ve={dev:"vuepress dev docs",build:"npm run build:lib && npm run build:docs","build:docs":"vuepress build docs","build:lib":"vue-tsc --noEmit --skipLibCheck && vite build --outDir lib","build:esm":"gulp --require sucrase/register/ts -f build/gulpfile.ts"},ge={},me={vue:"^3.2.47"},he={"@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.1","@types/gulp":"^4.0.10","@types/gulp-sass":"^5.0.0","@vitejs/plugin-vue":"^4.1.0","@vuepress/client":"^2.0.0-beta.61","element-plus":"^2.3.1","escape-html":"^1.0.3",gulp:"^4.0.2","gulp-rename":"^2.0.0","gulp-sass":"^5.1.0","markdown-it":"^13.0.1","markdown-it-container":"^3.0.0",rollup:"^3.20.2","rollup-plugin-terser":"^7.0.2","rollup-plugin-typescript2":"^0.34.1","rollup-plugin-vue":"^6.0.0",sass:"^1.60.0","sass-loader":"^13.2.2",sucrase:"^3.31.0",typescript:"^4.9.3","unplugin-element-plus":"^0.7.0","unplugin-vue-define-options":"^1.3.2",vite:"^4.2.0","vite-plugin-dts":"^2.1.0","vue-tsc":"^1.2.0",vuepress:"^2.0.0-beta.61"},J={name:ae,author:se,private:!1,version:re,main:ie,module:le,exports:ce,typings:ue,license:de,homepage:pe,files:fe,scripts:ve,dependencies:ge,peerDependencies:me,devDependencies:he},y=function(e){return typeof e=="string"},be=function(e){return typeof e=="number"},we=function(e){let n=-1;const i=e?e.length:0,c={};for(;++n<i;){const u=e[n];c[u[0]]=u[1]}return c},D=typeof window<"u"&&"ontouchstart"in window,k=function(){return{tapstart:D?"touchstart":"mousedown",tapmove:D?"touchmove":"mousemove",tapend:D?"touchend":"mouseup"}},V=function(e,n){try{let i=D?e.targetTouches[0].pageX:e.offsetX,c=D?e.targetTouches[0].pageY:e.offsetY;if(D){let u=n;for(;u&&u.tagName!=="BODY";)i-=u.offsetLeft,c-=u.offsetTop,u=u.offsetParent}return{x:i,y:c}}catch(i){console.log(i)}},E={print:(e,n,i)=>y(n)||typeof i=="boolean",pretty:(e,n,i)=>y(n)&&y(e)||typeof i=="string",primary:(e,n)=>y(e)||typeof n=="boolean",success:(e,n)=>y(e)||typeof n=="boolean",info:(e,n)=>y(e)||typeof n=="boolean",warning:(e,n)=>y(e)||typeof n=="boolean",danger:(e,n)=>y(e)||typeof n=="boolean"};function x(e="default"){let n="";switch(e){case"primary":n="#2d8cf0";break;case"success":n="#19be6b";break;case"info":n="#909399";break;case"warning":n="#ff9900";break;case"danger":n="#ff4d4f";break;case"default":n="#35495E";break;default:n=e;break}return n}E.print=function(e,n="default",i=!1){return typeof e=="object"?(console.dir(e),!0):(i?console.log(`%c ${e} `,`background:${x(n)}; padding: 2px; border-radius: 4px;color: #fff;`):console.log(`%c ${e} `,`color: ${x(n)};`),!0)};E.pretty=function(e,n,i="primary"){return console.log(`%c ${e} %c ${n} %c`,`background:${x(i)};border:1px solid ${x(i)}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border:1px solid ${x(i)}; padding: 1px; border-radius: 0 4px 4px 0; color: ${x(i)};`,"background:transparent"),!0};E.primary=function(e,n=!1){return this.print&&this.print(e,"primary",n),!0};E.success=function(e,n=!1){return this.print&&this.print(e,"success",n),!0};E.info=function(e,n=!1){return this.print&&this.print(e,"info",n),!0};E.warning=function(e,n=!1){return this.print&&this.print(e,"warning",n),!0};E.danger=function(e,n=!1){return this.print&&this.print(e,"danger",n),!0};const ye={async install(e){e.config.globalProperties.$log=E,E.pretty("["+J.name+"] "+J.version,"success")}};process.env.NODE_ENV!=="production"&&Object.freeze({});process.env.NODE_ENV!=="production"&&Object.freeze([]);const Ee=e=>e!==null&&typeof e=="object",K=Symbol("wrapper"),U="__elPropsReservedKey";function _e(e,n){if(!Ee(e)||e[U])return e;const{values:i,required:c,default:u,type:h,validator:d}=e,b=i||d?m=>{let w=!1,_=[];if(i&&(_=[...i,u],w=w||_.includes(m)),d&&(w=w||d(m)),!w&&_.length>0){const N=[...new Set(_)].map(z=>JSON.stringify(z)).join(", ");s.warn(`Invalid prop: validation failed${n?` for prop "${n}"`:""}. Expected one of [${N}], got value ${JSON.stringify(m)}.`)}return w}:void 0;return{type:typeof h=="object"&&h!==null&&Object.getOwnPropertySymbols(h).includes(K)?h[K]:h,validator:b,[U]:!0,default:u,required:!!c}}const Ce=e=>we(Object.entries(e).map(([n,i])=>[n,_e(i,n)])),ke=Ce({canvasWidth:Number,canvasHeight:Number,lineColor:{type:String,default:"#000"},lineWidth:{type:Number,default:3},bgColor:{type:String,default:"#f7f7f7"},imgBgColor:{type:String,default:"transparent"},crop:{type:Boolean,default:!0},footer:{type:Boolean,default:!0},beforeDone:Function,erasable:{type:Boolean,default:!0},eraserRadius:{type:Number,default:6}}),xe={"on-clear":()=>!0,"on-done":e=>y(e),orientationchange:e=>be(e)},De={class:"zm-sign"},Se={key:0,class:"zm-sign-tool"},Ne={class:"can_vans"},Le=["width","height"],Oe={key:1,class:"zm-sign-handle"},$e=s.defineComponent({name:"Vue3Sign"}),Pe=s.defineComponent({...$e,props:ke,emits:xe,setup(e,{expose:n,emit:i}){const c=e,u=s.ref(0),h=s.ref(0);s.watch(()=>c.canvasWidth,t=>{u.value=t}),s.watch(()=>c.canvasHeight,t=>{h.value=t});const d=s.ref(),b=s.ref();s.onMounted(()=>{const t=d.value;t.style.background=c.bgColor,b.value=t.getContext("2d"),N(!0),document.onmouseup=()=>{L()};const{tapstart:o,tapend:r}=k();if(document.addEventListener(r,L),t.addEventListener(o,F,{passive:!1}),typeof window<"u"){const a="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(a,N,!1)}}),s.onBeforeUnmount(()=>{const{tapend:t}=k();if(document.removeEventListener(t,L),typeof window<"u"){const o="onorientationchange"in window?"orientationchange":"resize";window.removeEventListener(o,N,!1)}});const m=s.ref(!1),w=t=>{m.value=t,m.value?ne(d.value):te(d.value)},_=s.ref(!1),N=t=>{const o=window.orientation;_.value=o==0||o==180,setTimeout(()=>{const r=window.innerWidth,a=window.innerHeight;_?z(r,a):A(r,a)},50),t!==!0&&i("orientationchange",o)},z=(t,o)=>{u.value=t-40,h.value=o/2},A=(t,o)=>{u.value=t-40,h.value=o-120},I=s.ref(!1),j=s.ref(!1),B=s.ref(0),R=s.ref(0),F=t=>{if(t.cancelable&&t.preventDefault(),m.value)return;const o=V(t,d.value);if(o){I.value=!0,j.value=!0,B.value=o.x,R.value=o.y;const p=b.value;p.lineCap="round",p.lineJoin="round",p.strokeStyle=c.lineColor,p.lineWidth=c.lineWidth,M(o,"source-over")}const{tapmove:r,tapend:a}=k(),l=d.value;l.addEventListener(r,T,{passive:!1}),l.addEventListener(a,W,{passive:!1})},T=t=>{if(t.cancelable&&t.preventDefault(),m.value||!I.value)return;const o=V(t,d.value);o&&(M(o,null),R.value=o.y,B.value=o.x)},W=t=>{if(t.cancelable&&t.preventDefault(),m.value)return;const o=d.value,{tapmove:r,tapend:a}=k();o.removeEventListener(r,T),o.removeEventListener(a,W)},M=({x:t,y:o},r)=>{const a=b.value;r&&(a.globalCompositeOperation=r),a.beginPath(),a.moveTo(B.value,R.value),a.lineTo(t,o),a.stroke(),a.closePath()},L=()=>{I.value=!1},H=()=>new Promise((o,r)=>{if(!j.value){r("Warning: Not Signned!");return}const a=d.value,l=b.value,p=l.getImageData(0,0,a.width,a.height);l.globalCompositeOperation="destination-over",l.fillStyle=c.bgColor,l.fillRect(0,0,a.width,a.height);let f=a.toDataURL();if(l.clearRect(0,0,a.width,a.height),l.putImageData(p,0,0),l.globalCompositeOperation="source-over",c.crop){const g=G(p.data),v=document.createElement("canvas"),C=v.getContext("2d");v.width=g[2]-g[0],v.height=g[3]-g[1];const oe=l.getImageData(...g);C.globalCompositeOperation="destination-over",C.putImageData(oe,0,0),C.fillStyle=c.imgBgColor,C.fillRect(0,0,v.width,v.height),f=v.toDataURL(),v.width>0&&v.height>0?o(f):r("Warning: Not Signned!")}w(m.value),o(f)}),G=t=>{const o=d.value;for(var r=o.width,a=0,l=o.height,p=0,f=0;f<o.width;f++)for(var g=0;g<o.height;g++){var v=(f+o.width*g)*4;(t[v]>0||t[v+1]>0||t[v+2]||t[v+3]>0)&&(p=Math.max(g,p),a=Math.max(f,a),l=Math.min(g,l),r=Math.min(f,r))}return r++,a++,l++,p++,[r,l,a,p]},Q=()=>{Y(),i("on-clear")},O=s.ref(""),Z=()=>{let t=d.value,o=!0;c.beforeDone&&typeof c.beforeDone=="function"&&(o=c.beforeDone(t)),o&&H().then(r=>{O.value=r,i("on-done",O.value)}).catch(()=>{O.value="",i("on-done","")})},Y=()=>{j.value=!1,w(m.value);const t=d.value;b.value.clearRect(0,0,t.width,t.height),O.value="",L()},ee=async()=>await H(),te=t=>{const{tapstart:o}=k();b.value.globalCompositeOperation="source-over",t.removeEventListener(o,q)},ne=t=>{if(!c.erasable)return;const{tapstart:o}=k(),r=b.value;r.lineCap="round",r.lineJoin="round",r.lineWidth=c.eraserRadius*2,r.globalCompositeOperation="destination-out",t.addEventListener(o,q,{passive:!1})},$=s.ref(0),P=s.ref(0),q=t=>{t.preventDefault();const o=d.value,{tapmove:r,tapend:a}=k();let l,p,f=V(t,o);$.value=f.x,P.value=f.y,X($.value,P.value),o.addEventListener(r,v,{passive:!1}),o.addEventListener(a,g,{passive:!1});function g(){o.removeEventListener(r,v),o.removeEventListener(a,g)}function v(C){C.preventDefault(),f=V(C,o),f&&(l=f.x,p=f.y,X($.value,P.value,l,p),$.value=l,P.value=p)}},X=(t,o,r,a)=>{const l=b.value;l.save(),l.beginPath(),r!==void 0&&a!==void 0?(l.arc(t,o,c.eraserRadius,0,2*Math.PI),l.fill()):(l.moveTo(t,o),l.lineTo(r,a),l.stroke()),l.restore()};return n({clear:Y,done:ee}),(t,o)=>(s.openBlock(),s.createElementBlock("div",De,[t.erasable?(s.openBlock(),s.createElementBlock("div",Se,[s.createElementVNode("span",{class:s.normalizeClass(["iconfont","icon-eraser",{active:m.value}]),onClick:o[0]||(o[0]=r=>w(!m.value))},null,2)])):s.createCommentVNode("",!0),s.createElementVNode("div",Ne,[s.createElementVNode("canvas",{ref_key:"canvasRef",ref:d,width:t.canvasWidth?t.canvasWidth:u.value,height:t.canvasHeight?t.canvasHeight:h.value},null,8,Le)]),t.footer?(s.openBlock(),s.createElementBlock("div",Oe,[s.createElementVNode("button",{class:"zm-buttom zm-button--mini",onClick:Q}," 清空 "),s.createElementVNode("button",{class:"zm-buttom zm-button--mini",onClick:Z}," 完成 ")])):s.createCommentVNode("",!0)]))}});const Ve=(e,n)=>{const i=e.__vccOpts||e;for(const[c,u]of n)i[c]=u;return i},S=Ve(Pe,[["__scopeId","data-v-2701f584"]]);S.install=function(e){e.component(S.name,S)};const ze=[S],Ie=function(e){ze.forEach(n=>{e.component(n.name,n)}),e.use(ye)},je={install:Ie,Vue3Sign:S};exports.Vue3Sign=S;exports.default=je;
